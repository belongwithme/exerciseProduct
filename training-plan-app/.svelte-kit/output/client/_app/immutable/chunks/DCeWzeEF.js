import"./CWj6FrbW.js";import{i as Pe}from"./BTdtOKhu.js";import{p as Te,as as $e,o as Je,i as d,m as O,f as I,d as r,r as t,s as o,V as Ne,g as e,n as Ce,t as k,j as w,w as ce,e as P,b as x,c as Ie,x as T,u as b,v as ve}from"./CDvu5KIv.js";import{i as Q}from"./pr_9b7ab.js";import{e as _e,i as ue}from"./DtTT7JPL.js";import{r as C}from"./CaJesokv.js";import{b as $}from"./0hSlB86f.js";import{b as Me}from"./CXBPNQEL.js";import{p as qe}from"./Bfc47y5P.js";import{p as Fe}from"./C6rgrwdz.js";import{s as ge}from"./x2EdFAPA.js";import{P as ze}from"./fNyos_Jn.js";import{T as Le}from"./D2aVQm2_.js";var Ue=I("<option> <!> <!></option>"),Ve=I('<div class="grid grid-cols-12 gap-2 items-center p-3 bg-gray-50 dark:bg-gray-700/50 rounded"><div class="col-span-12 md:col-span-4"><select class="w-full p-2 border rounded dark:bg-gray-600 dark:border-gray-500" required><option disabled>选择一个动作</option><!></select></div> <div class="col-span-6 md:col-span-2"><input type="number" placeholder="组" class="w-full p-2 border rounded dark:bg-gray-600 dark:border-gray-500" min="1"/></div> <div class="col-span-6 md:col-span-2"><input type="number" placeholder="次" class="w-full p-2 border rounded dark:bg-gray-600 dark:border-gray-500" min="1"/></div> <div class="col-span-6 md:col-span-2"><input type="number" placeholder="重量(kg)" class="w-full p-2 border rounded dark:bg-gray-600 dark:border-gray-500" min="0"/></div> <div class="col-span-6 md:col-span-2 flex justify-end"><button type="button" class="text-red-500 hover:text-red-700 p-2"><!></button></div></div>'),Ae=I('<p class="text-red-500 text-sm mb-4"> </p>'),Be=I('<div class="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4"><div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col"><div class="p-6 border-b"><h2 class="text-xl font-bold"> </h2></div> <form class="p-6 overflow-y-auto"><div class="mb-4"><label for="plan-name" class="block text-sm font-medium mb-1">计划名称</label> <input type="text" id="plan-name" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600" required/></div> <div class="mb-6"><label for="plan-description" class="block text-sm font-medium mb-1">计划描述</label> <textarea id="plan-description" rows="3" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600"></textarea></div> <div class="mb-4"><h3 class="text-lg font-semibold mb-2">训练动作</h3> <div class="space-y-4"></div> <button type="button" class="mt-4 inline-flex items-center px-3 py-2 text-sm font-medium text-center text-white bg-green-600 rounded-lg hover:bg-green-700"><!> 添加动作</button></div> <!></form> <div class="p-6 border-t flex justify-end space-x-4"><button type="button" class="px-4 py-2 rounded bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500">取消</button> <button type="submit" class="px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:bg-blue-400"> </button></div></div></div>');function sa(me,R){Te(R,!1);let f=Fe(R,"plan",8,null);const W=$e();let c=O(),l=O([]),M=O([]),y=O(!1),h=O("");Je(async()=>{f()?(d(c,{id:f().id,name:f().name,description:f().description}),d(l,JSON.parse(JSON.stringify(f().plan_exercises||[])))):be();const{data:i,error:a}=await ge.from("exercises").select("id, name, muscle_group, difficulty_level, type");a?console.error("获取动作列表失败:",a):d(M,i)});function be(){d(c,{id:null,name:"",description:""}),d(l,[])}function fe(){d(l,[...e(l),{exercise_id:"",exercises:{name:"请选择动作"},target_sets:3,target_reps:12,target_weight_kg:0,notes:"",exercise_order:e(l).length+1,day_of_week:1}])}function ye(i){d(l,e(l).filter((a,p)=>p!==i))}async function X(){d(y,!0),d(h,"");const i=e(l).filter(s=>s.exercise_id);if(i.length===0){d(h,"请至少添加一个训练动作"),d(y,!1);return}const a={...e(c),exercises:i.map((s,v)=>({exercise_id:s.exercise_id,target_sets:s.target_sets,target_reps:s.target_reps,target_weight_kg:s.target_weight_kg||null,notes:s.notes,exercise_order:v+1,day_of_week:s.day_of_week||1}))};let p;if(a.id?p=await fetch(`/api/plans/${a.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}):p=await fetch("/api/plans",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),p.ok){const s=await p.json();if(a.id)try{const v={plan_name:s.name,plan_description:s.description,exercises:i.map((u,S)=>({exercise_id:parseInt(u.exercise_id),target_sets:u.target_sets,target_reps:u.target_reps,target_weight_kg:u.target_weight_kg||null,notes:u.notes||"",exercise_order:S+1,day_of_week:u.day_of_week||1})),snapshot_created_at:new Date().toISOString(),snapshot_type:"manual_save"},{data:j,error:g}=await ge.rpc("create_plan_version",{p_plan_id:parseInt(a.id),p_content:v});g?(console.error("创建计划版本快照失败:",g),d(h,`计划保存成功，但版本快照创建失败: ${g.message}`)):console.log(`成功创建计划版本快照，版本号: ${j}`)}catch(v){console.error("版本管理操作异常:",v)}W("save",s),Y()}else{const s=await p.json();d(h,s.error||"保存失败，请重试。")}d(y,!1)}function Y(){W("close")}Pe();var q=Be(),Z=r(q),F=r(Z),ee=r(F),he=r(ee);t(ee),t(F);var J=o(F,2),z=r(J),ae=o(r(z),2);C(ae),t(z);var L=o(z,2),te=o(r(L),2);Ne(te),t(L);var U=o(L,2),V=o(r(U),2);_e(V,5,()=>e(l),ue,(i,a,p)=>{var s=Ve(),v=r(s),j=r(v);k(()=>{e(a),T(()=>{e(M)})});var g=r(j);g.value=g.__value="";var u=o(g);_e(u,1,()=>e(M),ue,(_,n)=>{var E=Ue(),de=r(E),le=o(de);{var Ee=m=>{var D=ve();k(()=>w(D,`- ${e(n),b(()=>e(n).muscle_group)??""}`)),x(m,D)};Q(le,m=>{e(n),b(()=>e(n).muscle_group)&&m(Ee)})}var De=o(le,2);{var Oe=m=>{var D=ve();k(()=>w(D,`(${e(n),b(()=>e(n).difficulty_level)??""})`)),x(m,D)};Q(De,m=>{e(n),b(()=>e(n).difficulty_level)&&m(Oe)})}t(E);var pe={};k(()=>{w(de,`${e(n),b(()=>e(n).name)??""} `),pe!==(pe=(e(n),b(()=>e(n).id)))&&(E.value=(E.__value=(e(n),b(()=>e(n).id)))??"")}),x(_,E)}),t(j),t(v);var S=o(v,2),se=r(S);C(se),t(S);var G=o(S,2),ie=r(G);C(ie),t(G);var H=o(G,2),oe=r(H);C(oe),t(H);var ne=o(H,2),K=r(ne),Se=r(K);Le(Se,{class:"w-5 h-5"}),t(K),t(ne),t(s),Me(j,()=>e(a).exercise_id,_=>(e(a).exercise_id=_,T(()=>e(l)))),$(se,()=>e(a).target_sets,_=>(e(a).target_sets=_,T(()=>e(l)))),$(ie,()=>e(a).target_reps,_=>(e(a).target_reps=_,T(()=>e(l)))),$(oe,()=>e(a).target_weight_kg,_=>(e(a).target_weight_kg=_,T(()=>e(l)))),P("click",K,()=>ye(p)),x(i,s)}),t(V);var A=o(V,2),ke=r(A);ze(ke,{class:"w-4 h-4 mr-2"}),Ce(),t(A),t(U);var we=o(U,2);{var xe=i=>{var a=Ae(),p=r(a,!0);t(a),k(()=>w(p,e(h))),x(i,a)};Q(we,i=>{e(h)&&i(xe)})}t(J);var re=o(J,2),B=r(re),N=o(B,2),je=r(N,!0);t(N),t(re),t(Z),t(q),k(()=>{w(he,`${f()?"编辑":"新建"}训练计划`),B.disabled=e(y),N.disabled=e(y),w(je,e(y)?"保存中...":"保存")}),$(ae,()=>e(c).name,i=>ce(c,e(c).name=i)),$(te,()=>e(c).description,i=>ce(c,e(c).description=i)),P("click",A,fe),P("submit",J,qe(X)),P("click",B,Y),P("click",N,X),x(me,q),Ie()}export{sa as default};
