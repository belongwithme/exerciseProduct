import"./CWj6FrbW.js";import{i as Ke}from"./DvY-oIkD.js";import{G as K,q as O,b as l,p as Oe,at as Qe,o as Ue,f as g,d as s,s as o,r as a,g as e,m as L,u as V,t as q,j as S,e as P,c as We,i,n as me,v as _e,y as Ye}from"./OdQOizuy.js";import{i as y}from"./C8SgvbjV.js";import{e as Ze}from"./CZywz5Xw.js";import{s as er}from"./BZ6qwgwY.js";import{l as Q,s as U,p as ye}from"./iScJf1SD.js";import{s as rr}from"./x2EdFAPA.js";import{H as he}from"./DBvLxdON.js";import{X as tr}from"./C5W0R8hy.js";import{s as W}from"./AOTWZyJM.js";import{I as Y}from"./hDZfQjOx.js";import{C as ar}from"./T8cJUWXe.js";function sr(C,b){const f=Q(b,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.525.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */const H=[["circle",{cx:"18",cy:"18",r:"3"}],["circle",{cx:"6",cy:"6",r:"3"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9"}]];Y(C,U({name:"git-compare"},()=>f,{get iconNode(){return H},children:(m,c)=>{var p=K(),_=O(p);W(_,b,"default",{}),l(m,p)},$$slots:{default:!0}}))}function or(C,b){const f=Q(b,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.525.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */const H=[["line",{x1:"4",x2:"20",y1:"9",y2:"9"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21"}]];Y(C,U({name:"hash"},()=>f,{get iconNode(){return H},children:(m,c)=>{var p=K(),_=O(p);W(_,b,"default",{}),l(m,p)},$$slots:{default:!0}}))}function nr(C,b){const f=Q(b,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.525.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */const H=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}]];Y(C,U({name:"rotate-ccw"},()=>f,{get iconNode(){return H},children:(m,c)=>{var p=K(),_=O(p);W(_,b,"default",{}),l(m,p)},$$slots:{default:!0}}))}var ir=g('<div class="mb-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg"><p class="text-red-800 dark:text-red-200 text-sm"> </p></div>'),lr=g('<div class="mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg"><div class="flex justify-between items-center"><div><p class="text-blue-800 dark:text-blue-200 font-medium">对比模式</p> <p class="text-blue-600 dark:text-blue-300 text-sm"><!></p></div> <button class="px-3 py-1.5 text-sm bg-blue-200 text-blue-800 rounded-md hover:bg-blue-300 dark:bg-blue-800 dark:text-blue-200 dark:hover:bg-blue-700">取消对比</button></div></div>'),dr=g('<div class="flex justify-center items-center py-12"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div> <span class="ml-3 text-gray-600 dark:text-gray-300">加载版本历史...</span></div>'),cr=g('<div class="text-center py-12"><!> <h3 class="mt-2 text-lg font-medium text-gray-900 dark:text-white">暂无版本历史</h3> <p class="mt-1 text-gray-500 dark:text-gray-400">此计划还没有保存过任何版本。</p></div>'),vr=g('<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100">最新版本</span>'),ur=g('<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100">已选择</span>'),br=g('<button class="px-3 py-1.5 text-sm bg-orange-100 text-orange-700 rounded-md hover:bg-orange-200 dark:bg-orange-900 dark:text-orange-300 dark:hover:bg-orange-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-1"><!> <span> </span></button>'),pr=g('<div class="flex space-x-2"><button class="px-3 py-1.5 text-sm bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 dark:bg-blue-900 dark:text-blue-300 dark:hover:bg-blue-800 transition-colors">查看详情</button> <!></div>'),gr=g('<div><div class="flex justify-between items-start"><div class="flex-1"><div class="flex items-center space-x-3 mb-2"><div class="flex items-center space-x-2"><!> <span class="font-semibold text-lg text-gray-800 dark:text-white"> </span></div> <!> <!></div> <div class="flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400"><!> <span> </span></div></div> <!></div></div>'),xr=g('<div class="space-y-4"></div>'),fr=g('<button class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center space-x-2"><!> <span>开始对比</span></button>'),mr=g('<div class="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4"><div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col"><div class="p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center"><div class="flex items-center space-x-3"><!> <div><h2 class="text-xl font-bold text-gray-800 dark:text-white">版本历史</h2> <p class="text-sm text-gray-600 dark:text-gray-400"> </p></div></div> <button class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"><!></button></div> <div class="flex-1 overflow-y-auto p-6"><!> <!> <!></div> <div class="p-6 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center"><div><!></div> <button class="px-4 py-2 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors">关闭</button></div></div></div>');function Nr(C,b){Oe(b,!1);let f=ye(b,"planId",8),H=ye(b,"planName",8,"");const m=Qe();let c=L([]),p=L(!0),_=L(!1),h=L(""),x=L(null),v=L(!1);function ke(r){return new Date(r).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}async function Z(){i(p,!0),i(h,"");try{const r=await fetch(`/api/plans/${f()}/versions`);if(r.ok)i(c,await r.json());else{const t=await r.json();i(h,t.error||"获取版本历史失败")}}catch(r){console.error("加载版本历史时发生错误:",r),i(h,"网络错误，请稍后重试")}finally{i(p,!1)}}async function we(r){try{const t=await fetch(`/api/plans/${f()}/versions/${r}`);if(t.ok){const d=await t.json();m("viewVersion",{versionNumber:r,content:d})}else{const d=await t.json();i(h,d.error||"获取版本详情失败")}}catch(t){console.error("查看版本详情时发生错误:",t),i(h,"网络错误，请稍后重试")}}async function $e(r){if(confirm(`确定要将计划恢复到版本 ${r} 吗？

这将会：
1. 备份当前版本
2. 将计划内容恢复到版本 ${r}
3. 创建新的版本记录

此操作不可撤销。`)){i(_,!0),i(h,"");try{const{data:t,error:d}=await rr.rpc("revert_to_plan_version",{p_plan_id:parseInt(f().toString()),p_target_version_number:r});if(d)throw d;await Z(),m("revertSuccess",{message:`成功恢复到版本 ${r}`,newVersionNumber:t.new_version_number})}catch(t){console.error("恢复版本时发生错误:",t),i(h,`恢复版本失败: ${t instanceof Error?t.message:"未知错误"}`)}finally{i(_,!1)}}}function Me(){i(v,!0),i(x,null)}function ee(){i(v,!1),i(x,null)}function je(r){e(v)&&(e(x)===null?i(x,r):(m("compare",{version1:e(x),version2:r}),ee()))}function re(){m("close")}Ue(()=>{Z()}),Ke();var E=mr(),te=s(E),F=s(te),G=s(F),ae=s(G);he(ae,{class:"w-6 h-6 text-blue-600"});var se=o(ae,2),oe=o(s(se),2),Ve=s(oe,!0);a(oe),a(se),a(G);var R=o(G,2),Ce=s(R);tr(Ce,{class:"w-5 h-5"}),a(R),a(F);var T=o(F,2),ne=s(T);{var He=r=>{var t=ir(),d=s(t),z=s(d,!0);a(d),a(t),q(()=>S(z,e(h))),l(r,t)};y(ne,r=>{e(h)&&r(He)})}var ie=o(ne,2);{var ze=r=>{var t=lr(),d=s(t),z=s(d),k=o(s(z),2),w=s(k);{var I=$=>{var j=_e("请选择第一个要对比的版本");l($,j)},n=$=>{var j=_e();q(()=>S(j,`已选择版本 ${e(x)??""}，请选择第二个版本进行对比`)),l($,j)};y(w,$=>{e(x)===null?$(I):$(n,!1)})}a(k),a(z);var N=o(z,2);a(d),a(t),P("click",N,ee),l(r,t)};y(ie,r=>{e(v)&&r(ze)})}var Ie=o(ie,2);{var Ne=r=>{var t=dr();l(r,t)},De=(r,t)=>{{var d=k=>{var w=cr(),I=s(w);he(I,{class:"mx-auto h-12 w-12 text-gray-400"}),me(4),a(w),l(k,w)},z=k=>{var w=xr();Ze(w,5,()=>e(c),I=>I.id,(I,n)=>{var N=gr(),$=s(N),j=s($),A=s(j),B=s(A),de=s(B);or(de,{class:"w-4 h-4 text-blue-600"});var ce=o(de,2),qe=s(ce);a(ce),a(B);var ve=o(B,2);{var Ee=u=>{var M=vr();l(u,M)};y(ve,u=>{e(n),e(c),V(()=>e(n).version_number===Math.max(...e(c).map(M=>M.version_number)))&&u(Ee)})}var Fe=o(ve,2);{var Ge=u=>{var M=ur();l(u,M)};y(Fe,u=>{e(v),e(x),e(n),V(()=>e(v)&&e(x)===e(n).version_number)&&u(Ge)})}a(A);var ue=o(A,2),be=s(ue);ar(be,{class:"w-4 h-4"});var pe=o(be,2),Re=s(pe,!0);a(pe),a(ue),a(j);var Te=o(j,2);{var Xe=u=>{var M=pr(),ge=s(M),Ae=o(ge,2);{var Be=J=>{var D=br(),xe=s(D);nr(xe,{class:"w-3 h-3"});var fe=o(xe,2),Je=s(fe,!0);a(fe),a(D),q(()=>{D.disabled=e(_),S(Je,e(_)?"恢复中...":"恢复")}),P("click",D,()=>$e(e(n).version_number)),l(J,D)};y(Ae,J=>{e(n),e(c),V(()=>e(n).version_number!==Math.max(...e(c).map(D=>D.version_number)))&&J(Be)})}a(M),P("click",ge,()=>we(e(n).version_number)),l(u,M)};y(Te,u=>{e(v)||u(Xe)})}a($),a(N),q(u=>{er(N,1,`bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 transition-colors cursor-pointer
								${e(v)?"hover:bg-blue-100 dark:hover:bg-blue-900/30":"hover:bg-gray-100 dark:hover:bg-gray-700"}
								${e(v),e(x),e(n),V(()=>e(v)&&e(x)===e(n).version_number?"bg-blue-100 dark:bg-blue-900/50 border border-blue-300 dark:border-blue-700":"")??""}`),S(qe,`版本 ${e(n),V(()=>e(n).version_number)??""}`),S(Re,u)},[()=>(e(n),V(()=>ke(e(n).created_at)))],Ye),P("click",N,()=>e(v)?je(e(n).version_number):null),l(I,N)}),a(w),l(k,w)};y(r,k=>{e(c),V(()=>e(c).length===0)?k(d):k(z,!1)},t)}};y(Ie,r=>{e(p)?r(Ne):r(De,!1)})}a(T);var le=o(T,2),X=s(le),Pe=s(X);{var Le=r=>{var t=fr(),d=s(t);sr(d,{class:"w-4 h-4"}),me(2),a(t),P("click",t,Me),l(r,t)};y(Pe,r=>{e(v),e(c),V(()=>!e(v)&&e(c).length>=2)&&r(Le)})}a(X);var Se=o(X,2);a(le),a(te),a(E),q(()=>S(Ve,H()||`计划 #${f()}`)),P("click",R,re),P("click",Se,re),l(C,E),We()}export{Nr as default};
